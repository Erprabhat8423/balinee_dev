{% load static %}
<input type="hidden" name="page" id="page" value="2" />
<input type="hidden" name="page_status" id="page_status" value="0" />
<input type="hidden" name="total_pages" id="total_pages" value="{{ total_pages }}" />
<table id="addOrgTable" class="detail-table table table-borderless table-striped table-hover mt-0"
style="width: 100%;">

<thead>
    <tr>
        <th class="table_student_name" id="table_student_name">
            Student Name
            <i class="fa fa-fw fa-sort float-right"></i>
            <img src="{% static 'img/svg/unfreeze.svg' %}" class="float-right" id="unfreeze">
            <img src="{% static 'img/svg/freeze.svg' %}" class="float-right" id="freeze">
        </th>
        <th class="table_student_name" id="table_father_name">
            Father Name
            <i class="fa fa-fw fa-sort float-right"></i>
            <img src="{% static 'img/svg/unfreeze.svg' %}" class="float-right" id="unfreeze">
            <img src="{% static 'img/svg/freeze.svg' %}" class="float-right" id="freeze">
        </th>
        <th class="table_college" id="table_college">College<i
            class="fa fa-fw fa-sort float-right"></i>
            <img src="{% static 'img/svg/unfreeze.svg' %}" class="float-right" id="unfreeze">
            <img src="{% static 'img/svg/freeze.svg' %}" class="float-right" id="freeze">
        </th>
        <th class="table_course" id="table_course">Course<i
            class="fa fa-fw fa-sort float-right"></i>
            <img src="{% static 'img/svg/unfreeze.svg' %}" class="float-right" id="unfreeze">
            <img src="{% static 'img/svg/freeze.svg' %}" class="float-right" id="freeze">
        </th>
        <th class="table_phone_no" id="table_phone_no">Phone No.<i class="fa fa-fw fa-sort float-right"></i>
            <img src="{% static 'img/svg/unfreeze.svg' %}" class="float-right" id="unfreeze">
            <img src="{% static 'img/svg/freeze.svg' %}" class="float-right" id="freeze">
        </th>
        <th>Action</th>
    </tr>
</thead>
<tbody id="tablebody">
    {% if students %}
    {% for student in students %}
    <tr  {% if forloop.first %} class="odd selected" {% endif %}>
        <td class="table_student_name" onclick="getStudentDetail('{{ student.id }}')">
            <div class="row">
                <span class="col-sm-10 col-10 pl-0 pr-2"> {{ student.first_name | title }} {% if student.middle_name is not None%}{{ student.middle_name | title }} {% endif %}{{ student.last_name | title }}</span> 
                <div class="col-sm-2 col-2 px-0">
                    {% if student.is_registered == 1 %}
                    <img src="{% static 'img/svg/Verified.svg' %}" alt="" width="15">
                    {% else %}
                    <img src="{% static 'img/svg/notVerified.svg' %}" alt="" width="15">
                    {% endif %}
                </div>
            </div>
        </td>
        <td class="table_father_name" onclick="getStudentDetail('{{ student.id }}')">
           {{ student.father_name | title }}
       </td>
       <td class="table_college" onclick="getStudentDetail('{{ student.id }}')">
           {{ student.college_name|safe }}
       </td>
       <td class="table_course" onclick="getStudentDetail('{{ student.id }}')">
           <span class="mr-2">{{ student.branch }}</span>
           <p class="mt-1">{{student.semester_year}}</p>
       </td>
       <td class="table_phone_no" onclick="getStudentDetail('{{ student.id }}')">
        <div class="row">
            <span class="col-sm-10 col-10 pl-0 pr-2">
                {{ student.primary_contact_no }}
            </span>
            <div class="col-2 col-sm-2 px-0">
                {% if student.is_mobile_verified == 1 %}
                <img src="{% static 'img/svg/Verified.svg' %}" alt="" width="15">
                {% else %}
                <img src="{% static 'img/svg/notVerified.svg' %}" alt="" width="15">
                {% endif %}
            </div>
        </div>
    </td>
    <td>
       <div class="row">
           <div class="col-md-3">
                {% if student.latitude %}
                <a href="javascript:void(0)" onclick="showMapView('{{ student.id  }}')" data-toggle="modal" data-target="#addCoordinates" title="View Coordinates">
                    <img src="{% static 'img/svg/viewonMap.svg' %}" class="tableRowIcon" />
                </a>
                {% else %}
                <a href="javascript:void(0)" onclick="showMapView('{{ student.id  }}')" data-toggle="modal" data-target="#addCoordinates" title="Add Coordinates">
                    <img src="{% static 'img/svg/viewonmapgray.svg' %}" class="tableRowIcon" />
                </a>
                {% endif %}
               <a href="javascript:void(0)"
               onclick="generateDigitalIdCard('{{ student.id }}')" data-toggle="modal"
               data-target="#addOrganisationModal" title="Generate Digital Id Card">
               {% if student.id_card_pin is None %}
               <img src="{% static 'img/svg/IDCardPIN.svg' %}" width="25" />
               {% else %}
               <img src="{% static 'img/svg/regenIDCard.svg' %}" width="25" />
               {% endif %}
           </a> 
       </div>
       <div class="col-md-5">
           <label class="switch" style="margin-top: 5px;">
               <input type="checkbox" class="checkbox" name="is_active"
               id="is_active_{{ student.id }}"
               {% if student.status == 1 %} checked="" {% else %}
               {% endif %}
               onclick="updateStudentStatus('{{ student.id }}', '{{ student.status }}')">
               <span class="slider round"></span>
           </label>
       </div>
   </div>
</td>
</tr>
{% endfor %}
<tr id="loading" style="display: none;">
    <td class="text-center" colspan="6"><i class="fa fa-spinner fa-spin" style="font-size:2rem"></i>
    </td>
</tr>

{% else %}
<tr>
    <td colspan="6" style="text-align: center;">No Record Found...</td>
</tr>
{% endif %}
</tbody>
</table>
<script type="text/javascript">
    $(document).ready(function () {
        var prevTop = 0;
        
        $('.commonTableBg').on('scroll', function () {
            var page = $('#page').val();
            var totalPages = $('#total_pages').val();
            console.log(totalPages);
            console.log(page);
            
            var currentTop = $(this).scrollTop();
            if (prevTop !== currentTop) {
                prevTop = currentTop;
                if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
                    
                    if($('#page_status').val() == 0 && page  <= totalPages){
                        $('#loading').show(); 
                        $('#page_status').val('1');
                        $.ajax({
                            url: "{% url 'src:ajax-student-lists' %}",
                            method: 'GET',
                            data: { page:page },
                            success: function (data) {
                                setTimeout(() => {
                                    $('#tablebody').find('tr:last').prev().after(data);
                                    $('#page').val(parseInt(page)+1);
                                    $('#loading').hide();
                                    $('#page_status').val('0');
                                }, 2000);
                                $("#addOrgTable").tablesorter({
                                    widgets: ["zebra", "resizable", "stickyHeaders"],
                                    widgetOptions: {
                                        resizable_addLastColumn: true,
                                        resizable: false,
                                        resizable_widths: ["20%", "20%", "20%", "15%", "15%","20%"],
                                        stickyHeaders_attachTo: ".primaryContainerBG",
                                    },
                                });
                                $("#addOrgTable tbody tr").click(function () {
                                    $(this).addClass("selected").siblings().removeClass("selected");
                                });
                                
                                $(".primaryContainerBG").scroll(function () {
                                    var divTable = $(".primaryContainerBG");
                                    $(".frezedCell").css("left", 0 + divTable.scrollLeft());
                                });
                                
                            },
                            error: function (err) {
                                alert(err.message);
                                window.location.reload();
                            }
                        });
                    }
                }
            }
        })
        
    });
</script>
<script>
    $(document).ready(function () {
        $(".fixed-column input:checkbox:checked").each(function () {
            var name = $(this).attr("name");
            var id = $(this).attr("id");
            var dataId = $(this).attr("data-id")
            toggleFreeze(id, name, dataId);
        }); 
        
        $(".show-hide input:checkbox:checked").each(function () {
            var id = $(this).attr("id");
            var dataId = $(this).attr("data-id")
            showHideColumns(id, dataId);
        });
        
        getOrganizationRecord('{{ organization_details.id }}');
    });
</script>